<div class="container" *ngIf="!isLoading() && !isError()">
  <!-- Product Detail Section -->
  <div class="product-detail">
    <div class="product-content">
      <!-- Image Gallery -->
      <div class="image-section">
        <div class="main-image">
          <img [src]="productDetail?.mainImage || 'https://via.placeholder.com/600x400'"
               [alt]="productDetail?.name"
               id="mainProductImage">
        </div>
        <div class="thumbnail-gallery">
          <div class="thumbnail"
               *ngFor="let image of productDetail?.images; let i = index; trackBy: trackByIndex"
               [class.active]="i === 0"
               (click)="changeMainImage(image)">
            <img [src]="image" [alt]="'·∫¢nh s·∫£n ph·∫©m ' + (i + 1)">
          </div>
        </div>
      </div>

      <!-- Product Info -->
      <div class="info-section">
        <h1 class="product-title">{{ productDetail?.name }}</h1>

        <div class="rating-section">
          <div class="stars">
            <span class="star"
                  *ngFor="let star of [1,2,3,4,5]; trackBy: trackByIndex"
                  [class.empty]="star > (productDetail?.rating || 0)">‚òÖ</span>
          </div>
          <span class="rating-text">
            {{ productDetail?.rating || 4.8 }}/5
            ({{ productDetail?.reviewCount || '7.5k' }} ƒë√°nh gi√°) |
            ƒê√£ b√°n {{ productDetail?.soldCount || '52.2k' }}
          </span>
        </div>

        <div class="price-section">
          <span class="current-price">{{ price() | currency:'VND':'symbol':'1.0-0' }}</span>
          <span class="original-price" *ngIf="productDetail?.originalPrice">
            {{ productDetail.originalPrice | currency:'VND':'symbol':'1.0-0' }}
          </span>
          <span class="discount-badge" *ngIf="productDetail?.discountPercent">
            -{{ productDetail.discountPercent }}%
          </span>
        </div>

        <div class="product-features">
          <div class="feature-item">
            <i class="icon">üöö</i>
            <span>Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn ƒë∆°n t·ª´ 0ƒë</span>
          </div>
          <div class="feature-item">
            <i class="icon">üéÅ</i>
            <span>T·∫∑ng voucher 15.000ƒë cho ƒë∆°n h√†ng ti·∫øp theo</span>
          </div>
          <div class="feature-item">
            <i class="icon">üíØ</i>
            <span>Cam k·∫øt ch·∫•t l∆∞·ª£ng ho·∫∑c ho√†n ti·ªÅn</span>
          </div>
        </div>

        <!-- Product Options -->
        <div class="product-options">
          <!-- Size Selection -->
          <div class="option-group" *ngIf="getAttributeValues('size').length > 0">
            <label class="option-label">K√≠ch th∆∞·ªõc</label>
            <div class="option-buttons">
              <button class="option-btn"
                      *ngFor="let size of getAttributeValues('size'); trackBy: trackByIndex"
                      [class.active]="selectedSize() === size"
                      (click)="onSizeChange(size)">
                {{ size }}
              </button>
            </div>
          </div>

          <!-- Color Selection -->
          <div class="option-group" *ngIf="getAttributeValues('color').length > 0">
            <label class="option-label">M√†u s·∫Øc</label>
            <div class="option-buttons">
              <button class="option-btn color-btn"
                      *ngFor="let color of getAttributeValues('color'); trackBy: trackByIndex"
                      [class.active]="selectedColor() === color"
                      (click)="onColorChange(color)">
                {{ color }}
              </button>
            </div>
          </div>

          <!-- Quantity -->
          <div class="option-group">
            <label class="option-label">S·ªë l∆∞·ª£ng</label>
            <div class="quantity-controls">
              <button class="qty-btn" (click)="decreaseQuantity()" [disabled]="quantity() <= 1">-</button>
              <input type="number"
                     class="qty-input"
                     [value]="quantity()"
                     (input)="onQuantityInput($event)"
                     min="1"
                     [max]="stock()">
              <button class="qty-btn" (click)="increaseQuantity()" [disabled]="quantity() >= stock()">+</button>
            </div>
            <span class="stock-info">{{ stock() }} s·∫£n ph·∫©m c√≥ s·∫µn</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn btn-primary" (click)="addToCart()" [disabled]="stock() <= 0">
            <i class="icon">üõí</i>
            Th√™m v√†o gi·ªè h√†ng
          </button>
          <button class="btn btn-secondary" (click)="buyNow()" [disabled]="stock() <= 0">
            <i class="icon">‚ö°</i>
            Mua ngay
          </button>
        </div>

        <!-- Social Actions -->
        <div class="social-actions">
          <button class="social-btn" (click)="toggleWishlist()">
            <i class="icon">‚ù§Ô∏è</i>
            Y√™u th√≠ch
          </button>
          <button class="social-btn" (click)="shareProduct()">
            <i class="icon">üì§</i>
            Chia s·∫ª
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Shop Information -->
  <div class="shop-section">
    <div class="shop-header">
      <div class="shop-avatar">
        <img [src]="productDetail?.shopLogo || 'https://via.placeholder.com/80x80'"
             [alt]="productDetail?.shopName">
      </div>
      <div class="shop-info">
        <h3 class="shop-name">{{ productDetail?.shopName || 'ƒêiHu Store' }}</h3>
        <p class="shop-status">Online {{ productDetail?.lastOnline || '51 ph√∫t tr∆∞·ªõc' }}</p>
      </div>
      <div class="shop-actions">
        <button class="btn btn-outline">
          <i class="icon">üí¨</i>
          Chat ngay
        </button>
        <button class="btn btn-outline">
          <i class="icon">üè™</i>
          Xem shop
        </button>
      </div>
    </div>

    <div class="shop-stats">
      <div class="stat-item">
        <span class="stat-value">{{ productDetail?.shopStats?.reviews || '28.5k' }}</span>
        <span class="stat-label">ƒê√°nh gi√°</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">{{ productDetail?.shopStats?.responseRate || '97%' }}</span>
        <span class="stat-label">T·ª∑ l·ªá ph·∫£n h·ªìi</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">{{ productDetail?.shopStats?.joinedTime || '4 nƒÉm' }}</span>
        <span class="stat-label">Tham gia</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">{{ productDetail?.shopStats?.products || '73' }}</span>
        <span class="stat-label">S·∫£n ph·∫©m</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">{{ productDetail?.shopStats?.followers || '30.2k' }}</span>
        <span class="stat-label">Ng∆∞·ªùi theo d√µi</span>
      </div>
    </div>
  </div>

  <!-- Product Details -->
  <div class="details-section">
    <h2 class="section-title">Chi ti·∫øt s·∫£n ph·∫©m</h2>
    <div class="details-grid">
      <div class="detail-item" *ngFor="let detail of productDetails; trackBy: trackByIndex">
        <span class="detail-label">{{ detail.label }}</span>
        <span class="detail-value">{{ detail.value }}</span>
      </div>
    </div>
  </div>

  <!-- Product Description -->
  <div class="description-section" *ngIf="productDetail?.description">
    <h2 class="section-title">M√¥ t·∫£ s·∫£n ph·∫©m</h2>
    <div class="description-content" [innerHTML]="productDetail.description"></div>
  </div>

  <!-- Reviews Section -->
  <div class="reviews-section">
    <div class="reviews-header">
      <h2 class="section-title">ƒê√°nh gi√° s·∫£n ph·∫©m</h2>
      <div class="rating-summary">
        <div class="rating-overview">
          <span class="rating-score">{{ productDetail?.rating || 4.8 }}</span>
          <span class="rating-text">tr√™n 5</span>
        </div>
        <div class="rating-breakdown">
          <div class="rating-bar" *ngFor="let rating of ratingBreakdown; trackBy: trackByIndex">
            <span class="rating-stars">{{ rating.stars }} sao</span>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="rating.percentage"></div>
            </div>
            <span class="rating-count">({{ rating.count }})</span>
          </div>
        </div>
      </div>
    </div>

    <div class="review-filters">
      <button class="filter-btn active" (click)="setReviewFilter('all')">T·∫•t c·∫£</button>
      <button class="filter-btn" (click)="setReviewFilter('with-comment')">C√≥ b√¨nh lu·∫≠n (3.1k)</button>
      <button class="filter-btn" (click)="setReviewFilter('with-media')">C√≥ h√¨nh ·∫£nh (1.3k)</button>
      <button class="filter-btn" (click)="setReviewFilter('5-star')">5 sao</button>
      <button class="filter-btn" (click)="setReviewFilter('4-star')">4 sao</button>
    </div>

    <div class="reviews-list">
      <div class="review-item" *ngFor="let review of filteredReviews(); trackBy: trackByIndex">
        <div class="review-header">
          <div class="reviewer-avatar">
            <img [src]="review.avatar || 'https://via.placeholder.com/40x40'" [alt]="review.username">
          </div>
          <div class="reviewer-info">
            <h4 class="reviewer-name">{{ review.username }}</h4>
            <div class="review-rating">
              <span class="star" *ngFor="let star of [1,2,3,4,5]; trackBy: trackByIndex"
                    [class.empty]="star > review.rating">‚òÖ</span>
            </div>
            <p class="review-date">{{ review.date | date:'dd/MM/yyyy' }} | {{ review.variant }}</p>
          </div>
        </div>
        <div class="review-content">
          <p>{{ review.content }}</p>
        </div>
        <div class="review-images" *ngIf="review.images && review.images.length > 0">
          <img *ngFor="let image of review.images; trackBy: trackByIndex"
               [src]="image"
               [alt]="'Review image'"
               (click)="openImageModal(image)">
        </div>
        <div class="review-actions">
          <button class="like-btn" (click)="likeReview(review.id)">
            <i class="icon">üëç</i>
            {{ review.likes || 0 }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="isLoading()">
  <div class="loading-spinner"></div>
  <p>ƒêang t·∫£i th√¥ng tin s·∫£n ph·∫©m...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="isError()">
  <div class="error-content">
    {{ productDetail.shopName }}  <i class="error-icon">‚ö†Ô∏è</i>
    <h3>C√≥ l·ªói x·∫£y ra</h3>
    <p>Kh√¥ng th·ªÉ t·∫£i th√¥ng tin s·∫£n ph·∫©m. Vui l√≤ng th·ª≠ l·∫°i sau.</p>
    <button class="btn btn-primary" (click)="loadDetailProduct()">Th·ª≠ l·∫°i</button>
  </div>
</div>
